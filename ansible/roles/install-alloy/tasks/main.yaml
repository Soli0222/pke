---
- name: Install Alloy
  ansible.builtin.include_role:
    name: grafana.grafana.alloy
  vars:
    alloy_config: |
      prometheus.exporter.unix "nodeexporter" {}

      prometheus.scrape "nodeexporter" {
        targets = prometheus.exporter.unix.nodeexporter.targets
        forward_to = [prometheus.remote_write.victoriametrics.receiver]
      }

      prometheus.remote_write "victoriametrics" {
        endpoint {
          url = "https://vminsert.oky.pke.pstr.space/insert/0/prometheus/"
        }
      }