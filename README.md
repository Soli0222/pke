# Polestar Kubernetes Engine (PKE)

Soliが開発・運用・保守を行っているサービス群のオンプレ環境用リポジトリです。

## 🏗️ アーキテクチャ概要

### kkgクラスタ

物理ノード3台によって構成されるProxmox VEクラスタで、HAKubernetesクラスターを運用しています。

#### ハードウェア構成

| ホスト名  | CPU             | メモリ | ストレージ | IPアドレス    |
|-----------|-----------------|--------|-----------|---------------|
| kkg-pve1  | Intel N100      | 16GB   | 512GB SSD | 192.168.20.2  |
| kkg-pve2  | Intel N100      | 16GB   | 512GB SSD | 192.168.20.3  |
| kkg-pve3  | Ryzen 5 3400G   | 32GB   | 512GB SSD | 192.168.20.4  |

#### 仮想マシン構成

##### ロードバランサ (HAProxy + keepalived)
| VM名     | CPU | メモリ | ディスク | IPアドレス     | ホストマシン |
|----------|-----|--------|----------|---------------|-------------|
| kkg-lb1  | 4   | 2GB    | 20GB     | 192.168.20.11 | kkg-pve1    |
| kkg-lb2  | 4   | 2GB    | 20GB     | 192.168.20.12 | kkg-pve2    |

##### Kubernetesコントロールプレーン
| VM名     | CPU | メモリ | ディスク | IPアドレス     | ホストマシン |
|----------|-----|--------|----------|---------------|-------------|
| kkg-cp1  | 4   | 4GB    | 50GB     | 192.168.20.13 | kkg-pve1    |
| kkg-cp2  | 4   | 4GB    | 50GB     | 192.168.20.14 | kkg-pve2    |
| kkg-cp3  | 4   | 4GB    | 50GB     | 192.168.20.15 | kkg-pve3    |

##### Kubernetesワーカーノード
| VM名     | CPU | メモリ | ディスク | IPアドレス     | ホストマシン |
|----------|-----|--------|----------|---------------|-------------|
| kkg-wk1  | 4   | 8GB    | 50GB     | 192.168.20.16 | kkg-pve1    |
| kkg-wk2  | 4   | 8GB    | 50GB     | 192.168.20.17 | kkg-pve2    |
| kkg-wk3  | 8   | 24GB   | 100GB    | 192.168.20.18 | kkg-pve3    |

## 📁 プロジェクト構成

### Terraform
- VMの作成・管理を自動化
- Ubuntu 24.04 Cloud Imageを直接使用（テンプレート不要）
- Proxmoxプロバイダーを使用してインフラをコード化

### Ansible
- VM作成後の設定・ソフトウェアインストールを自動化
- Kubernetes、CRI-O、HAProxy、keepalivedなどの設定

### Manifest
- Kubernetesクラスタ上で動作するアプリケーションのマニフェスト
- Helm ChartsとKubernetesマニフェストを管理 
